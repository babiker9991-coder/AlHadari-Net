<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>منتدى الحضري الثقافي</title>
<style>
body{font-family:"Cairo",sans-serif;background:#f2f5f8;margin:0;padding:0}
header{background:#6a1b9a;color:#fff;padding:20px;text-align:center;font-size:28px;font-weight:bold}
.container{max-width:900px;margin:20px auto;padding:15px;background:#fff;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.15)}
input,textarea,button{width:100%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid #ccc;font-size:14px}
button{background:#6a1b9a;color:#fff;border:none;cursor:pointer;font-weight:bold}
button:hover{background:#4a148c}
.post{border-bottom:1px solid #ddd;padding:15px 0}
.comment{background:#f0f0f0;margin:6px 0;padding:8px;border-radius:5px;font-size:14px}
.comments-box{margin-top:10px}
</style>
</head>
<body>

<header>منتدى الحضري الثقافي</header>

<div class="container">
  <h3>أضف مشاركة جديدة</h3>
  <input type="text" id="postTitle" placeholder="عنوان المشاركة">
  <textarea id="postContent" placeholder="محتوى المشاركة"></textarea>
  <button onclick="addPost()">نشر المشاركة</button>
  <p id="status"></p>
  <hr>
  <h3>آخر المشاركات</h3>
  <div id="postsList">جارٍ تحميل المشاركات...</div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-database-compat.js"></script>

<script>
/* ======== ضع إعدادات Firebase هنا ======== */
const firebaseConfig = {
  apiKey: "ضع_apiKey_هنا",
  authDomain: "ضع_authDomain_هنا",
  databaseURL: "https://alhadari-net-default-rtdb.firebaseio.com",
  projectId: "ضع_projectId_هنا",
  storageBucket: "ضع_projectId_هنا.appspot.com",
  messagingSenderId: "ضع_messagingSenderId_هنا",
  appId: "ضع_appId_هنا"
};
/* ======================================== */

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function addPost(){
  const title = document.getElementById('postTitle').value.trim();
  const content = document.getElementById('postContent').value.trim();
  const status = document.getElementById('status');
  status.textContent = '';
  if(!title || !content){ status.textContent="الرجاء تعبئة العنوان والمحتوى"; return; }
  const postRef = db.ref('posts').push();
  postRef.set({
    title,
    content,
    createdAt: Date.now()
  });
  document.getElementById('postTitle').value='';
  document.getElementById('postContent').value='';
  status.textContent='✅ تم نشر المشاركة';
}

function loadPosts(){
  const postsList = document.getElementById('postsList');
  db.ref('posts').orderByChild('createdAt').on('value', snapshot=>{
    postsList.innerHTML='';
    const data = snapshot.val();
    if(!data){ postsList.innerHTML='<p>لا توجد مشاركات بعد.</p>'; return; }
    const entries = Object.keys(data).map(k=>({id:k,v:data[k]})).sort((a,b)=>b.v.createdAt - a.v.createdAt);
    entries.forEach(entry=>{
      const p = entry.v;
      const div = document.createElement('div');
      div.className='post';
      div.innerHTML=`<h4>${p.title}</h4>
                     <p>${p.content}</p>
                     <div class="comments-box" id="comments-${entry.id}">
                       <input id="commentInput-${entry.id}" placeholder="أضف تعليقك...">
                       <button onclick="addComment('${entry.id}')">إرسال</button>
                       <div id="commentsList-${entry.id}"></div>
                     </div>`;
      postsList.appendChild(div);

      // عرض التعليقات
      db.ref('posts/' + entry.id + '/comments').on('value', snap=>{
        const list = document.getElementById('commentsList-' + entry.id);
        list.innerHTML='';
        snap.forEach(c=>{
          const cm = c.val();
          const cd = document.createElement('div');
          cd.className='comment';
          cd.textContent = `${cm.user||'زائر'}: ${cm.text}`;
          list.appendChild(cd);
        });
      });
    });
  });
}

function addComment(postId){
  const input = document.getElementById('commentInput-' + postId);
  const text = input.value.trim();
  if(!text) return;
  db.ref('posts/' + postId + '/comments').push({user:'زائر',text});
  input.value='';
}

// تحميل المشاركات عند فتح الصفحة
window.addEventListener('load', loadPosts);
</script>

</body>
</html>
