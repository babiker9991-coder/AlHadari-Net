<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ† Ø§Ù„Ø­Ø¶Ø±ÙŠ Ù†Øª Ø±ÙŠØ§Ø¶Ø©</title>
<style>
body {
  font-family: "Cairo", sans-serif;
  background: #f4f7fb;
  margin: 0;
  padding: 0;
}
header {
  background: #003366;
  color: #fff;
  text-align: center;
  padding: 20px;
  font-size: 26px;
  font-weight: bold;
}
.container {
  width: 90%;
  max-width: 900px;
  margin: 20px auto;
  background: #fff;
  border-radius: 10px;
  padding: 20px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}
input, textarea, button {
  width: 100%;
  padding: 10px;
  margin: 8px 0;
  border-radius: 6px;
  border: 1px solid #ccc;
}
button {
  background: #003366;
  color: #fff;
  cursor: pointer;
  font-weight: bold;
}
button:hover {
  background: #0055aa;
}
.news-item {
  border-bottom: 1px solid #ddd;
  padding-bottom: 15px;
  margin-bottom: 20px;
}
.news-item img {
  width: 100%;
  border-radius: 6px;
}
.actions {
  display: flex;
  justify-content: space-between;
  margin-top: 10px;
}
.comment-box {
  margin-top: 10px;
  border-top: 1px solid #eee;
  padding-top: 10px;
}
.comment {
  background: #f0f0f0;
  margin: 5px 0;
  padding: 8px;
  border-radius: 5px;
}
.admin-panel {display: none; background: #eef3ff; padding: 10px; border-radius: 10px;}
</style>
</head>
<body>

<header>Ø§Ù„Ø­Ø¶Ø±ÙŠ Ù†Øª Ø±ÙŠØ§Ø¶Ø©</header>

<div class="container">
  <div class="admin-panel" id="adminPanel">
    <h3>Ø¥Ø¶Ø§ÙØ© Ø®Ø¨Ø± Ø¬Ø¯ÙŠØ¯</h3>
    <input type="text" id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø®Ø¨Ø±">
    <textarea id="content" placeholder="Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø®Ø¨Ø±"></textarea>
    <input type="file" id="image">
    <button onclick="addNews()">Ù†Ø´Ø± Ø§Ù„Ø®Ø¨Ø±</button>
    <p id="status"></p>
  </div>

  <h2 style="text-align:center;color:#003366;">ğŸ“° Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</h2>
  <div id="newsList"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-storage.js"></script>

<script>
// Ø¶Ø¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© Ù…Ù† Firebase Ù‡Ù†Ø§ ğŸ‘‡
const firebaseConfig = {
  apiKey: "Ø¶Ø¹_Ù…ÙØªØ§Ø­Ùƒ_Ù‡Ù†Ø§",
  authDomain: "Ø¶Ø¹_Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†_Ù‡Ù†Ø§",
  databaseURL: "Ø¶Ø¹_Ø±Ø§Ø¨Ø·_Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©_Ù‡Ù†Ø§",
  projectId: "Ø¶Ø¹_ID_Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",
  storageBucket: "Ø¶Ø¹_storageBucket_Ù‡Ù†Ø§",
  messagingSenderId: "Ø¶Ø¹_Ø§Ù„Ø±Ù‚Ù…_Ù‡Ù†Ø§",
  appId: "Ø¶Ø¹_AppID_Ù‡Ù†Ø§"
};
firebase.initializeApp(firebaseConfig);

const db = firebase.database();
const storage = firebase.storage();

const adminEmail = "babiker9991@gmail.com";
const currentUser = adminEmail; // Ù…Ø¤Ù‚ØªÙ‹Ø§ Ø§Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·

if (currentUser === adminEmail) {
  document.getElementById("adminPanel").style.display = "block";
}

async function addNews() {
  const title = document.getElementById("title").value;
  const content = document.getElementById("content").value;
  const imageFile = document.getElementById("image").files[0];
  const status = document.getElementById("status");

  if (!title || !content || !imageFile) {
    status.innerText = "âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„";
    return;
  }

  status.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...";

  try {
    const imageRef = storage.ref("images/" + Date.now() + "_" + imageFile.name);
    await imageRef.put(imageFile);
    const imageUrl = await imageRef.getDownloadURL();

    await db.ref("news").push({
      title,
      content,
      imageUrl,
      likes: 0
    });

    status.innerText = "âœ… ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­!";
    document.getElementById("title").value = "";
    document.getElementById("content").value = "";
    document.getElementById("image").value = "";
  } catch (err) {
    status.innerText = "âŒ Ø®Ø·Ø£: " + err.message;
  }
}

const newsList = document.getElementById("newsList");

db.ref("news").on("value", (snapshot) => {
  newsList.innerHTML = "";
  snapshot.forEach((child) => {
    const news = child.val();
    const key = child.key;

    const div = document.createElement("div");
    div.classList.add("news-item");
    div.innerHTML = `
      <h3>${news.title}</h3>
      <img src="${news.imageUrl}" alt="">
      <p>${news.content}</p>
      <div class="actions">
        <button onclick="likeNews('${key}')">â¤ï¸ ${news.likes || 0}</button>
        <button onclick="toggleComments('${key}')">ğŸ’¬ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</button>
      </div>
      <div id="comments-${key}" class="comment-box" style="display:none;">
        <input id="comment-input-${key}" placeholder="Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ‚Ùƒ...">
        <button onclick="addComment('${key}')">Ø¥Ø±Ø³Ø§Ù„</button>
        <div id="comments-list-${key}"></div>
      </div>
    `;
    newsList.prepend(div);

    db.ref(`news/${key}/comments`).on("value", (commentsSnapshot) => {
      const list = document.getElementById(`comments-list-${key}`);
      list.innerHTML = "";
      commentsSnapshot.forEach((c) => {
        const data = c.val();
        const commentDiv = document.createElement("div");
        commentDiv.classList.add("comment");
        commentDiv.textContent = `${data.user}: ${data.text}`;
        list.appendChild(commentDiv);
      });
    });
  });
});

function likeNews(id) {
  const ref = db.ref(`news/${id}/likes`);
  ref.transaction(likes => (likes || 0) + 1);
}

function toggleComments(id) {
  const section = document.getElementById(`comments-${id}`);
  section.style.display = section.style.display === "none" ? "block" : "none";
}

function addComment(id) {
  const input = document.getElementById(`comment-input-${id}`);
  const text = input.value.trim();
  if (!text) return;
  const user = currentUser.split("@")[0];
  db.ref(`news/${id}/comments`).push({ user, text });
  input.value = "";
}
</script>

</body>
</html>
